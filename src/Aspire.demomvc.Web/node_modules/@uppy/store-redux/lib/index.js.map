{"version":3,"names":["nanoid","packageJson","STATE_UPDATE","defaultSelector","id","state","uppy","getPatch","prev","next","nextKeys","Object","keys","patch","forEach","k","_id","_classPrivateFieldLooseKey","_selector","_store","_Symbol$for","Symbol","for","ReduxStore","constructor","opts","defineProperty","writable","value","_classPrivateFieldLooseBase","store","selector","setState","dispatch","type","payload","getState","subscribe","cb","prevState","nextState","VERSION","version","reducer","action","newState","middleware"],"sources":["index.js"],"sourcesContent":["import { nanoid } from 'nanoid/non-secure'\n\nimport packageJson from '../package.json'\n\n// Redux action name.\nexport const STATE_UPDATE = 'uppy/STATE_UPDATE'\n\n// Pluck Uppy state from the Redux store in the default location.\nconst defaultSelector = (id) => (state) => state.uppy[id]\n\nfunction getPatch (prev, next) {\n  const nextKeys = Object.keys(next)\n  const patch = {}\n  nextKeys.forEach((k) => {\n    if (prev[k] !== next[k]) patch[k] = next[k]\n  })\n  return patch\n}\n\n/**\n * Redux store.\n *\n * @param {object} opts.store - The Redux store to use.\n * @param {string} opts.id - This store instance's ID. Defaults to a random string.\n *    If you need to access Uppy state through Redux, eg. to render custom UI, set this to something constant.\n * @param {Function} opts.selector - Function, `(state) => uppyState`, to pluck state from the Redux store.\n *    Defaults to retrieving `state.uppy[opts.id]`. Override if you placed Uppy state elsewhere in the Redux store.\n */\nexport class ReduxStore {\n  static VERSION = packageJson.version\n\n  #id\n\n  #selector\n\n  #store\n\n  constructor (opts) {\n    this.#store = opts.store\n    this.#id = opts.id || nanoid()\n    this.#selector = opts.selector || defaultSelector(this.#id)\n\n    // Calling `setState` to dispatch an action to the Redux store.\n    // The intent is to make sure that the reducer has run once.\n    this.setState({})\n  }\n\n  setState (patch) {\n    this.#store.dispatch({\n      type: STATE_UPDATE,\n      id: this.#id,\n      payload: patch,\n    })\n  }\n\n  getState () {\n    return this.#selector(this.#store.getState())\n  }\n\n  subscribe (cb) {\n    let prevState = this.getState()\n    return this.#store.subscribe(() => {\n      const nextState = this.getState()\n      if (prevState !== nextState) {\n        const patch = getPatch(prevState, nextState)\n        cb(prevState, nextState, patch)\n        prevState = nextState\n      }\n    })\n  }\n\n  [Symbol.for('uppy test: get id')] () {\n    return this.#id\n  }\n}\n\nexport function reducer (state = {}, action) {\n  if (action.type === STATE_UPDATE) {\n    const newState = { ...state[action.id], ...action.payload }\n    return { ...state, [action.id]: newState }\n  }\n  return state\n}\n\nexport function middleware () {\n  // Do nothing, at the moment.\n  return () => (next) => (action) => {\n    next(action)\n  }\n}\n\nexport default ReduxStore\n"],"mappings":"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"}