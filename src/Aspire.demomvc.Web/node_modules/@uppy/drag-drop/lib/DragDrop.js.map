{"version":3,"names":["UIPlugin","toArray","isDragDropSupported","getDroppedFiles","h","packageJson","locale","defaultOptions","inputName","width","height","DragDrop","constructor","uppy","opts","addFiles","files","descriptors","map","file","source","id","name","type","data","meta","relativePath","err","log","onInputChange","event","target","length","value","handleDragOver","_this$opts$onDragOver","_this$opts","preventDefault","stopPropagation","types","dataTransfer","hasFiles","some","allowNewUpload","getState","dropEffect","clearTimeout","removeDragOverClassTimeout","setPluginState","isDraggingOver","onDragOver","call","handleDragLeave","_this$opts$onDragLeav","_this$opts2","setTimeout","onDragLeave","handleDrop","_this$opts$onDrop","_this$opts3","logDropError","error","onDrop","title","defaultLocale","i18nInit","renderHiddenFileInput","restrictions","className","hidden","ref","fileInputRef","multiple","maxNumberOfFiles","accept","allowedFileTypes","onChange","renderArrowSvg","focusable","viewBox","d","fillRule","renderLabel","i18nArray","browse","i18n","renderNote","note","render","dragDropClass","getPluginState","dragDropStyle","style","onClick","click","install","mount","uninstall","unmount","VERSION","version"],"sources":["DragDrop.tsx"],"sourcesContent":["import { UIPlugin, type Uppy } from '@uppy/core'\nimport type { DefinePluginOpts } from '@uppy/core/lib/BasePlugin'\nimport type { UIPluginOptions } from '@uppy/core/lib/UIPlugin'\nimport type { Body, Meta } from '@uppy/utils/lib/UppyFile'\nimport type { ChangeEvent } from 'preact/compat'\nimport toArray from '@uppy/utils/lib/toArray'\nimport isDragDropSupported from '@uppy/utils/lib/isDragDropSupported'\nimport getDroppedFiles from '@uppy/utils/lib/getDroppedFiles'\nimport { h, type ComponentChild } from 'preact'\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../package.json'\nimport locale from './locale.ts'\n\nexport interface DragDropOptions extends UIPluginOptions {\n  inputName?: string\n  allowMultipleFiles?: boolean\n  width?: string | number\n  height?: string | number\n  note?: string\n  onDragOver?: (event: DragEvent) => void\n  onDragLeave?: (event: DragEvent) => void\n  onDrop?: (event: DragEvent) => void\n}\n\n// Default options, must be kept in sync with @uppy/react/src/DragDrop.js.\nconst defaultOptions = {\n  inputName: 'files[]',\n  width: '100%',\n  height: '100%',\n} satisfies Partial<DragDropOptions>\n\n/**\n * Drag & Drop plugin\n *\n */\nexport default class DragDrop<M extends Meta, B extends Body> extends UIPlugin<\n  DefinePluginOpts<DragDropOptions, keyof typeof defaultOptions>,\n  M,\n  B\n> {\n  static VERSION = packageJson.version\n\n  // Check for browser dragDrop support\n  private isDragDropSupported = isDragDropSupported()\n\n  private removeDragOverClassTimeout!: ReturnType<typeof setTimeout>\n\n  private fileInputRef!: HTMLInputElement\n\n  constructor(uppy: Uppy<M, B>, opts?: DragDropOptions) {\n    super(uppy, {\n      ...defaultOptions,\n      ...opts,\n    })\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DragDrop'\n    this.title = 'Drag & Drop'\n\n    this.defaultLocale = locale\n\n    this.i18nInit()\n  }\n\n  private addFiles = (files: File[]) => {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: (file as any).relativePath || null,\n      } as any as M,\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err as any)\n    }\n  }\n\n  private onInputChange = (event: ChangeEvent) => {\n    const files = toArray((event.target as HTMLInputElement).files!)\n    if (files.length > 0) {\n      this.uppy.log('[DragDrop] Files selected through input')\n      this.addFiles(files)\n    }\n\n    // We clear the input after a file is selected, because otherwise\n    // change event is not fired in Chrome and Safari when a file\n    // with the same name is selected.\n    // ___Why not use value=\"\" on <input/> instead?\n    //    Because if we use that method of clearing the input,\n    //    Chrome will not trigger change if we drop the same file twice (Issue #768).\n    // @ts-expect-error TS freaks out, but this is fine\n    // eslint-disable-next-line no-param-reassign\n    event.target.value = null\n  }\n\n  private handleDragOver = (event: DragEvent) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    // Check if the \"type\" of the datatransfer object includes files. If not, deny drop.\n    const { types } = event.dataTransfer!\n    const hasFiles = types.some((type) => type === 'Files')\n    const { allowNewUpload } = this.uppy.getState()\n    if (!hasFiles || !allowNewUpload) {\n      // eslint-disable-next-line no-param-reassign\n      event.dataTransfer!.dropEffect = 'none'\n      clearTimeout(this.removeDragOverClassTimeout)\n      return\n    }\n\n    // Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser\n    // https://github.com/transloadit/uppy/issues/1978)\n    //\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer!.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    this.setPluginState({ isDraggingOver: true })\n\n    this.opts.onDragOver?.(event)\n  }\n\n  private handleDragLeave = (event: DragEvent) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n\n    this.opts.onDragLeave?.(event)\n  }\n\n  private handleDrop = async (event: DragEvent) => {\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // Remove dragover class\n    this.setPluginState({ isDraggingOver: false })\n\n    const logDropError = (error: any) => {\n      this.uppy.log(error, 'error')\n    }\n\n    // Add all dropped files\n    const files = await getDroppedFiles(event.dataTransfer!, { logDropError })\n    if (files.length > 0) {\n      this.uppy.log('[DragDrop] Files dropped')\n      this.addFiles(files)\n    }\n\n    this.opts.onDrop?.(event)\n  }\n\n  private renderHiddenFileInput() {\n    const { restrictions } = this.uppy.opts\n    return (\n      <input\n        className=\"uppy-DragDrop-input\"\n        type=\"file\"\n        hidden\n        ref={(ref) => {\n          this.fileInputRef = ref!\n        }}\n        name={this.opts.inputName}\n        multiple={restrictions.maxNumberOfFiles !== 1}\n        // @ts-expect-error We actually want to coerce the array to a string (or keep it as null/undefined)\n        accept={restrictions.allowedFileTypes}\n        onChange={this.onInputChange}\n      />\n    )\n  }\n\n  private static renderArrowSvg() {\n    return (\n      <svg\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className=\"uppy-c-icon uppy-DragDrop-arrow\"\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n      >\n        <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fillRule=\"evenodd\" />\n      </svg>\n    )\n  }\n\n  private renderLabel() {\n    return (\n      <div className=\"uppy-DragDrop-label\">\n        {this.i18nArray('dropHereOr', {\n          browse: (\n            <span className=\"uppy-DragDrop-browse\">{this.i18n('browse')}</span>\n          ) as any,\n        })}\n      </div>\n    )\n  }\n\n  private renderNote() {\n    return <span className=\"uppy-DragDrop-note\">{this.opts.note}</span>\n  }\n\n  render(): ComponentChild {\n    const dragDropClass = `uppy-u-reset\n      uppy-DragDrop-container\n      ${this.isDragDropSupported ? 'uppy-DragDrop--isDragDropSupported' : ''}\n      ${this.getPluginState().isDraggingOver ? 'uppy-DragDrop--isDraggingOver' : ''}\n    `\n\n    const dragDropStyle = {\n      width: this.opts.width,\n      height: this.opts.height,\n    }\n\n    return (\n      <button\n        type=\"button\"\n        className={dragDropClass}\n        style={dragDropStyle}\n        onClick={() => this.fileInputRef.click()}\n        onDragOver={this.handleDragOver}\n        onDragLeave={this.handleDragLeave}\n        onDrop={this.handleDrop}\n      >\n        {this.renderHiddenFileInput()}\n        <div className=\"uppy-DragDrop-inner\">\n          {DragDrop.renderArrowSvg()}\n          {this.renderLabel()}\n          {this.renderNote()}\n        </div>\n      </button>\n    )\n  }\n\n  install(): void {\n    const { target } = this.opts\n\n    this.setPluginState({\n      isDraggingOver: false,\n    })\n\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall(): void {\n    this.unmount()\n  }\n}\n"],"mappings":"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"}