{"version":3,"names":["nanoid","EventManager","ProgressTimeout","ErrorWithCause","NetworkError","isNetworkError","internalRateLimitedQueue","buildResponseError","xhr","error","err","cause","request","setTypeInBlob","file","dataWithUpdatedType","data","slice","size","meta","type","addMetadata","formData","opts","allowedMetaFields","Array","isArray","Object","keys","forEach","item","append","createFormDataUpload","formPost","FormData","name","fieldName","createBareUpload","_addEventHandlerForFile","_classPrivateFieldLooseKey","_addEventHandlerIfFileStillExists","MiniXHRUpload","constructor","uppy","defineProperty","value","_addEventHandlerIfFileStillExists2","_addEventHandlerForFile2","validateStatus","status","requests","uploaderEvents","create","i18n","getOptions","_file$xhrUpload","overrides","getState","xhrUpload","headers","uploadLocalFile","Promise","resolve","reject","XMLHttpRequest","id","timer","timeout","abort","queuedRequest","done","Error","seconds","Math","ceil","emit","upload","addEventListener","log","ev","loaded","total","progress","lengthComputable","getFile","uploader","bytesUploaded","bytesTotal","remove","target","responseText","body","getResponseData","uploadURL","responseUrlFieldName","uploadResp","getResponseError","response","open","method","toUpperCase","endpoint","withCredentials","Boolean","responseType","header","setRequestHeader","run","send","priority","_classPrivateFieldLooseBase","_temp","reason","eventName","fileID","eventHandler","on","fileOrID","_fileOrID$id","_this","arguments"],"sources":["MiniXHRUpload.js"],"sourcesContent":["import { nanoid } from 'nanoid/non-secure'\nimport EventManager from '@uppy/utils/lib/EventManager'\nimport ProgressTimeout from '@uppy/utils/lib/ProgressTimeout'\nimport ErrorWithCause from '@uppy/utils/lib/ErrorWithCause'\nimport NetworkError from '@uppy/utils/lib/NetworkError'\nimport isNetworkError from '@uppy/utils/lib/isNetworkError'\nimport { internalRateLimitedQueue } from '@uppy/utils/lib/RateLimitedQueue'\n\n// See XHRUpload\nfunction buildResponseError (xhr, error) {\n  if (isNetworkError(xhr)) return new NetworkError(error, xhr)\n\n  const err = new ErrorWithCause('Upload error', { cause: error })\n  err.request = xhr\n  return err\n}\n\n// See XHRUpload\nfunction setTypeInBlob (file) {\n  const dataWithUpdatedType = file.data.slice(0, file.data.size, file.meta.type)\n  return dataWithUpdatedType\n}\n\nfunction addMetadata (formData, meta, opts) {\n  const allowedMetaFields = Array.isArray(opts.allowedMetaFields)\n    ? opts.allowedMetaFields\n    // Send along all fields by default.\n    : Object.keys(meta)\n  allowedMetaFields.forEach((item) => {\n    formData.append(item, meta[item])\n  })\n}\n\nfunction createFormDataUpload (file, opts) {\n  const formPost = new FormData()\n\n  addMetadata(formPost, file.meta, opts)\n\n  const dataWithUpdatedType = setTypeInBlob(file)\n\n  if (file.name) {\n    formPost.append(opts.fieldName, dataWithUpdatedType, file.meta.name)\n  } else {\n    formPost.append(opts.fieldName, dataWithUpdatedType)\n  }\n\n  return formPost\n}\n\nconst createBareUpload = file => file.data\n\nexport default class MiniXHRUpload {\n  constructor (uppy, opts) {\n    this.uppy = uppy\n    this.opts = {\n      validateStatus (status) {\n        return status >= 200 && status < 300\n      },\n      ...opts,\n    }\n\n    this.requests = opts[internalRateLimitedQueue]\n    this.uploaderEvents = Object.create(null)\n    this.i18n = opts.i18n\n  }\n\n  getOptions (file) {\n    const { uppy } = this\n\n    const overrides = uppy.getState().xhrUpload\n    const opts = {\n      ...this.opts,\n      ...(overrides || {}),\n      ...(file.xhrUpload || {}),\n      headers: {\n        ...this.opts.headers,\n        ...overrides?.headers,\n        ...file.xhrUpload?.headers,\n      },\n    }\n\n    return opts\n  }\n\n  #addEventHandlerForFile (eventName, fileID, eventHandler) {\n    this.uploaderEvents[fileID].on(eventName, (fileOrID) => {\n      // TODO (major): refactor Uppy events to consistently send file objects (or consistently IDs)\n      // We created a generic `addEventListenerForFile` but not all events\n      // use file IDs, some use files, so we need to do this weird check.\n      const id = fileOrID?.id ?? fileOrID\n      if (fileID === id) eventHandler()\n    })\n  }\n\n  #addEventHandlerIfFileStillExists (eventName, fileID, eventHandler) {\n    this.uploaderEvents[fileID].on(eventName, (...args) => {\n      if (this.uppy.getFile(fileID)) eventHandler(...args)\n    })\n  }\n\n  uploadLocalFile (file) {\n    const opts = this.getOptions(file)\n\n    return new Promise((resolve, reject) => {\n      // This is done in index.js in the S3 plugin.\n      // this.uppy.emit('upload-started', file)\n\n      const data = opts.formData\n        ? createFormDataUpload(file, opts)\n        : createBareUpload(file, opts)\n\n      const xhr = new XMLHttpRequest()\n      this.uploaderEvents[file.id] = new EventManager(this.uppy)\n\n      const timer = new ProgressTimeout(opts.timeout, () => {\n        xhr.abort()\n        // eslint-disable-next-line no-use-before-define\n        queuedRequest.done()\n        const error = new Error(this.i18n('timedOut', { seconds: Math.ceil(opts.timeout / 1000) }))\n        this.uppy.emit('upload-error', file, error)\n        reject(error)\n      })\n\n      const id = nanoid()\n\n      xhr.upload.addEventListener('loadstart', () => {\n        this.uppy.log(`[AwsS3/XHRUpload] ${id} started`)\n      })\n\n      xhr.upload.addEventListener('progress', (ev) => {\n        this.uppy.log(`[AwsS3/XHRUpload] ${id} progress: ${ev.loaded} / ${ev.total}`)\n        // Begin checking for timeouts when progress starts, instead of loading,\n        // to avoid timing out requests on browser concurrency queue\n        timer.progress()\n\n        if (ev.lengthComputable) {\n          this.uppy.emit('upload-progress', this.uppy.getFile(file.id), {\n            uploader: this,\n            bytesUploaded: ev.loaded,\n            bytesTotal: ev.total,\n          })\n        }\n      })\n\n      xhr.addEventListener('load', (ev) => {\n        this.uppy.log(`[AwsS3/XHRUpload] ${id} finished`)\n        timer.done()\n        // eslint-disable-next-line no-use-before-define\n        queuedRequest.done()\n        if (this.uploaderEvents[file.id]) {\n          this.uploaderEvents[file.id].remove()\n          this.uploaderEvents[file.id] = null\n        }\n\n        if (opts.validateStatus(ev.target.status, xhr.responseText, xhr)) {\n          const body = opts.getResponseData(xhr.responseText, xhr)\n          const uploadURL = body[opts.responseUrlFieldName]\n\n          const uploadResp = {\n            status: ev.target.status,\n            body,\n            uploadURL,\n          }\n\n          this.uppy.emit('upload-success', this.uppy.getFile(file.id), uploadResp)\n\n          if (uploadURL) {\n            this.uppy.log(`Download ${file.name} from ${uploadURL}`)\n          }\n\n          return resolve(file)\n        }\n        const body = opts.getResponseData(xhr.responseText, xhr)\n        const error = buildResponseError(xhr, opts.getResponseError(xhr.responseText, xhr))\n\n        const response = {\n          status: ev.target.status,\n          body,\n        }\n\n        this.uppy.emit('upload-error', file, error, response)\n        return reject(error)\n      })\n\n      xhr.addEventListener('error', () => {\n        this.uppy.log(`[AwsS3/XHRUpload] ${id} errored`)\n        timer.done()\n        // eslint-disable-next-line no-use-before-define\n        queuedRequest.done()\n        if (this.uploaderEvents[file.id]) {\n          this.uploaderEvents[file.id].remove()\n          this.uploaderEvents[file.id] = null\n        }\n\n        const error = buildResponseError(xhr, opts.getResponseError(xhr.responseText, xhr))\n        this.uppy.emit('upload-error', file, error)\n        return reject(error)\n      })\n\n      xhr.open(opts.method.toUpperCase(), opts.endpoint, true)\n      // IE10 does not allow setting `withCredentials` and `responseType`\n      // before `open()` is called. Itâ€™s important to set withCredentials\n      // to a boolean, otherwise React Native crashes\n      xhr.withCredentials = Boolean(opts.withCredentials)\n      if (opts.responseType !== '') {\n        xhr.responseType = opts.responseType\n      }\n\n      Object.keys(opts.headers).forEach((header) => {\n        xhr.setRequestHeader(header, opts.headers[header])\n      })\n\n      const queuedRequest = this.requests.run(() => {\n        xhr.send(data)\n        return () => {\n          // eslint-disable-next-line no-use-before-define\n          timer.done()\n          xhr.abort()\n        }\n      }, { priority: 1 })\n\n      this.#addEventHandlerForFile('file-removed', file.id, () => {\n        queuedRequest.abort()\n        reject(new Error('File removed'))\n      })\n\n      this.#addEventHandlerIfFileStillExists('cancel-all', file.id, ({ reason } = {}) => {\n        if (reason === 'user') {\n          queuedRequest.abort()\n        }\n        reject(new Error('Upload cancelled'))\n      })\n    })\n  }\n}\n"],"mappings":"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"}