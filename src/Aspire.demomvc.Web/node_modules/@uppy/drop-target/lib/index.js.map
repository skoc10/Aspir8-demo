{"version":3,"names":["BasePlugin","getDroppedFiles","toArray","packageJson","defaultOpts","target","isFileTransfer","event","_event$dataTransfer$t","_event$dataTransfer","dataTransfer","types","some","type","DropTarget","constructor","uppy","opts","addFiles","files","descriptors","map","file","source","id","name","data","meta","relativePath","err","log","handleDrop","_event$currentTarget","_this$opts$onDrop","_this$opts","preventDefault","stopPropagation","clearTimeout","removeDragOverClassTimeout","currentTarget","classList","remove","setPluginState","isDraggingOver","iteratePlugins","plugin","handleRootDrop","executedDropErrorOnce","logDropError","error","info","message","length","onDrop","call","handleDragOver","_this$opts$onDragOver","_this$opts2","dropEffect","add","onDragOver","handleDragLeave","_this$opts$onDragLeav","_this$opts3","setTimeout","onDragLeave","addListeners","Element","nodes","document","querySelectorAll","Error","forEach","node","addEventListener","removeListeners","removeEventListener","title","install","uninstall","VERSION","version"],"sources":["index.ts"],"sourcesContent":["import type { Body, Meta } from '@uppy/utils/lib/UppyFile'\nimport type { Uppy } from '@uppy/core/lib/Uppy'\nimport type { DefinePluginOpts, PluginOpts } from '@uppy/core/lib/BasePlugin.js'\nimport BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport getDroppedFiles from '@uppy/utils/lib/getDroppedFiles'\nimport toArray from '@uppy/utils/lib/toArray'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore We don't want TS to generate types for the package.json\nimport packageJson from '../package.json'\n\nexport interface DropTargetOptions extends PluginOpts {\n  target?: HTMLElement | string | null\n  onDrop?: (event: DragEvent) => void\n  onDragOver?: (event: DragEvent) => void\n  onDragLeave?: (event: DragEvent) => void\n}\n\n// Default options\nconst defaultOpts = {\n  target: null,\n} satisfies DropTargetOptions\n\ninterface DragEventWithFileTransfer extends DragEvent {\n  dataTransfer: NonNullable<DragEvent['dataTransfer']>\n}\n\nfunction isFileTransfer(event: DragEvent): event is DragEventWithFileTransfer {\n  return event.dataTransfer?.types?.some((type) => type === 'Files') ?? false\n}\n\n/**\n * Drop Target plugin\n *\n */\nexport default class DropTarget<\n  M extends Meta,\n  B extends Body,\n> extends BasePlugin<\n  DefinePluginOpts<DropTargetOptions, keyof typeof defaultOpts>,\n  M,\n  B\n> {\n  static VERSION = packageJson.version\n\n  private removeDragOverClassTimeout: ReturnType<typeof setTimeout>\n\n  private nodes?: Array<HTMLElement>\n\n  constructor(uppy: Uppy<M, B>, opts?: DropTargetOptions) {\n    super(uppy, { ...defaultOpts, ...opts })\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DropTarget'\n    // @ts-expect-error TODO: remove in major\n    this.title = 'Drop Target'\n  }\n\n  addFiles = (files: Array<File>): void => {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: (file as any).relativePath || null,\n      } as any,\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  handleDrop = async (event: DragEvent): Promise<void> => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // Remove dragover class\n    ;(event.currentTarget as HTMLElement)?.classList.remove('uppy-is-drag-over')\n    this.setPluginState({ isDraggingOver: false })\n\n    // Let any acquirer plugin (Url/Webcam/etc.) handle drops to the root\n    this.uppy.iteratePlugins((plugin) => {\n      if (plugin.type === 'acquirer') {\n        // @ts-expect-error Every Plugin with .type acquirer can define handleRootDrop(event)\n        plugin.handleRootDrop?.(event)\n      }\n    })\n\n    // Add all dropped files, handle errors\n    let executedDropErrorOnce = false\n    const logDropError = (error: Error): void => {\n      this.uppy.log(error, 'error')\n\n      // In practice all drop errors are most likely the same,\n      // so let's just show one to avoid overwhelming the user\n      if (!executedDropErrorOnce) {\n        this.uppy.info(error.message, 'error')\n        executedDropErrorOnce = true\n      }\n    }\n\n    const files = await getDroppedFiles(event.dataTransfer, { logDropError })\n    if (files.length > 0) {\n      this.uppy.log('[DropTarget] Files were dropped')\n      this.addFiles(files)\n    }\n\n    this.opts.onDrop?.(event)\n  }\n\n  handleDragOver = (event: DragEvent): void => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n\n    // Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser,\n    // https://github.com/transloadit/uppy/issues/1978)\n    event.dataTransfer.dropEffect = 'copy' // eslint-disable-line no-param-reassign\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    ;(event.currentTarget as HTMLElement).classList.add('uppy-is-drag-over')\n    this.setPluginState({ isDraggingOver: true })\n    this.opts.onDragOver?.(event)\n  }\n\n  handleDragLeave = (event: DragEvent): void => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n\n    const { currentTarget } = event\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      ;(currentTarget as HTMLElement).classList.remove('uppy-is-drag-over')\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n    this.opts.onDragLeave?.(event)\n  }\n\n  addListeners = (): void => {\n    const { target } = this.opts\n\n    if (target instanceof Element) {\n      this.nodes = [target]\n    } else if (typeof target === 'string') {\n      this.nodes = toArray(document.querySelectorAll(target))\n    }\n\n    if (!this.nodes || this.nodes.length === 0) {\n      throw new Error(`\"${target}\" does not match any HTML elements`)\n    }\n\n    this.nodes.forEach((node) => {\n      node.addEventListener('dragover', this.handleDragOver, false)\n      node.addEventListener('dragleave', this.handleDragLeave, false)\n      node.addEventListener('drop', this.handleDrop, false)\n    })\n  }\n\n  removeListeners = (): void => {\n    if (this.nodes) {\n      this.nodes.forEach((node) => {\n        node.removeEventListener('dragover', this.handleDragOver, false)\n        node.removeEventListener('dragleave', this.handleDragLeave, false)\n        node.removeEventListener('drop', this.handleDrop, false)\n      })\n    }\n  }\n\n  install(): void {\n    this.setPluginState({ isDraggingOver: false })\n    this.addListeners()\n  }\n\n  uninstall(): void {\n    this.removeListeners()\n  }\n}\n"],"mappings":"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"}